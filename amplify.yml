version: 1
backend:
  phases:
    build:
      commands:
        - npm ci --cache .npm --prefer-offline
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
frontend:
  phases:
    preBuild:
      commands:
        - npx ng version
    build:
      commands:
        - npx ng build --configuration=production
  artifacts:
    baseDirectory: dist/amplify-angular-template/browser
    files:
      - '**/*'
  cache:
    paths:
      - .npm/**/*
      - node_modules/**/*
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Cross-Origin-Opener-Policy'
          value: 'same-origin-allow-popups'
        - key: 'Cross-Origin-Embedder-Policy'
          value: 'credentialless'
        - key: 'Permissions-Policy'
          value: 'unload=()'
