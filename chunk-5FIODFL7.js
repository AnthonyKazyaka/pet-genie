import{a as pt}from"./chunk-7ZK65QDP.js";import{a as vt,b as V,c as ft}from"./chunk-LZWUSLKQ.js";import"./chunk-HF736BE6.js";import"./chunk-EKRWJKAO.js";import"./chunk-RIANM46A.js";import"./chunk-JCPHAOSO.js";import{b as mt,f as _t}from"./chunk-MAT2C2GM.js";import"./chunk-XWJJCW7V.js";import{c as it}from"./chunk-7PU356LQ.js";import{a as Q,b as W}from"./chunk-CUDXFYQC.js";import{A as rt,B as ct,C as st,b as tt,l as et,r as nt,w as ot,y as at}from"./chunk-M5VACLKZ.js";import{a as Ct,b as gt}from"./chunk-LBWROMG6.js";import{b as dt}from"./chunk-PTLTVG7R.js";import"./chunk-7VLTXITI.js";import{c as lt}from"./chunk-WNYBICT2.js";import{a as j,c as A,e as G,f as H,h as U}from"./chunk-XMUMTGGQ.js";import{a as X,b as Z}from"./chunk-AQORW4WI.js";import{fa as Y,g as N,ia as q,ja as J,ka as K}from"./chunk-77V6CQ2B.js";import{Bb as D,Cb as F,Db as o,Eb as n,Fb as b,Jb as M,Mb as u,Ob as l,Pc as z,Yb as a,Zb as P,_a as c,_b as k,d as C,fc as B,ha as f,hc as $,lb as w,ma as R,rb as x,s as _,tb as S,ua as h,va as y,vb as L,yb as m}from"./chunk-5MEO4XP4.js";var yt=(e,s)=>s.event.id,xt=e=>["/visit",e];function Mt(e,s){if(e&1){let t=M();o(0,"mat-card",4)(1,"mat-card-content")(2,"app-empty-state",8)(3,"button",9),u("click",function(){h(t);let r=l();return y(r.connectCalendar())}),o(4,"mat-icon"),a(5,"link"),n(),a(6," Connect Calendar "),n()()()()}}function Pt(e,s){e&1&&(o(0,"div",5),b(1,"mat-spinner",10),o(2,"p"),a(3,"Loading today's visits..."),n()())}function Ot(e,s){e&1&&(o(0,"mat-card",6)(1,"mat-card-content"),b(2,"app-empty-state",11),n()())}function wt(e,s){e&1&&(o(0,"mat-icon",18),a(1,"link"),n())}function St(e,s){if(e&1&&(o(0,"p",20)(1,"mat-icon"),a(2,"pets"),n(),o(3,"span"),a(4),n()()),e&2){let t=l().$implicit;c(4),P(t.petNames.join(", "))}}function kt(e,s){if(e&1&&(o(0,"p",21)(1,"mat-icon"),a(2,"location_on"),n(),a(3),n()),e&2){let t=l().$implicit;c(3),k(" ",t.event.location," ")}}function Tt(e,s){if(e&1&&(o(0,"div",22)(1,"mat-icon"),a(2,"note"),n(),o(3,"p"),a(4),n()()),e&2){let t=l().$implicit;c(4),P(t.visitRecord==null?null:t.visitRecord.notes)}}function Et(e,s){if(e&1){let t=M();o(0,"button",9),u("click",function(){h(t);let r=l().$implicit,d=l(2);return y(d.createVisit(r))}),o(1,"mat-icon"),a(2,"add"),n(),a(3," Create Visit "),n()}}function bt(e,s){if(e&1){let t=M();o(0,"button",27),u("click",function(){h(t);let r=l(2).$implicit,d=l(2);return y(d.linkClient(r))}),o(1,"mat-icon"),a(2,"link"),n(),a(3," Link Client "),n()}}function Vt(e,s){if(e&1){let t=M();o(0,"button",28),u("click",function(){h(t);let r=l(2).$implicit,d=l(2);return y(d.checkIn(r))}),o(1,"mat-icon"),a(2,"login"),n(),a(3," Check In "),n()}}function It(e,s){if(e&1){let t=M();o(0,"button",9),u("click",function(){h(t);let r=l(2).$implicit,d=l(2);return y(d.checkOut(r))}),o(1,"mat-icon"),a(2,"logout"),n(),a(3," Complete Visit "),n()}}function Rt(e,s){if(e&1&&(o(0,"button",26)(1,"mat-icon"),a(2,"visibility"),n(),a(3," View Details "),n()),e&2){let t=l(2).$implicit;S("routerLink",$(1,xt,t.visitRecord.id))}}function Lt(e,s){if(e&1&&x(0,bt,4,0,"button",24)(1,Vt,4,0,"button",25)(2,It,4,0,"button",23)(3,Rt,4,3,"button",26),e&2){let t=l().$implicit;m(0,t.visitRecord.clientId?-1:0),c(),m(1,t.displayStatus==="scheduled"?1:-1),c(),m(2,t.displayStatus==="in-progress"?2:-1),c(),m(3,t.displayStatus==="completed"?3:-1)}}function Dt(e,s){if(e&1&&(o(0,"mat-card",13)(1,"mat-card-header")(2,"div",14)(3,"mat-icon"),a(4,"schedule"),n(),o(5,"span"),a(6),n()(),o(7,"mat-chip",15),a(8),n()(),o(9,"mat-card-content")(10,"div",16)(11,"div",17)(12,"h3"),a(13),n(),x(14,wt,2,0,"mat-icon",18),n(),o(15,"p",19)(16,"mat-icon"),a(17,"pets"),n(),a(18),n(),x(19,St,5,1,"p",20)(20,kt,4,1,"p",21)(21,Tt,5,1,"div",22),n()(),o(22,"mat-card-actions"),x(23,Et,4,0,"button",23)(24,Lt,4,4),n()()),e&2){let t=s.$implicit,i=l(2);L("completed",t.displayStatus==="completed")("in-progress",t.displayStatus==="in-progress"),c(6),P(i.formatTime(t.event.start)),c(),S("color",i.getStatusColor(t.displayStatus)),c(),k(" ",t.displayStatus," "),c(5),P(t.clientName),c(),m(14,t.linkedClient?14:-1),c(4),k(" ",t.serviceType," "),c(),m(19,t.petNames.length>0?19:-1),c(),m(20,t.event.location?20:-1),c(),m(21,t.visitRecord!=null&&t.visitRecord.notes?21:-1),c(2),m(23,t.visitRecord?-1:23),c(),m(24,t.visitRecord?24:-1)}}function Ft(e,s){if(e&1&&(o(0,"div",7),D(1,Dt,25,15,"mat-card",12,yt),n()),e&2){let t=l();c(),F(t.visits())}}var de=(()=>{class e{constructor(){this.googleCalendarService=f(at),this.eventProcessor=f(ot),this.visitRecordService=f(st),this.dataService=f(tt),this.clientService=f(rt),this.petService=f(ct),this.dialog=f(lt),this.snackBar=f(Ct),this.isLoading=w(!1),this.visits=w([]),this.isConnected=w(!1),this.refreshListener=null}ngOnInit(){return C(this,null,function*(){this.isConnected.set(this.googleCalendarService.isSignedIn()),this.isConnected()&&(yield this.loadTodayVisits()),this.refreshListener=()=>this.loadTodayVisits(),window.addEventListener("calendar-refresh",this.refreshListener)})}ngOnDestroy(){this.refreshListener&&window.removeEventListener("calendar-refresh",this.refreshListener)}loadTodayVisits(){return C(this,null,function*(){this.isLoading.set(!0);try{let t=new Date,i={start:et(t),end:nt(t)},r=this.dataService.settings(),d=yield _(this.googleCalendarService.fetchEventsFromCalendars(r.selectedCalendars,i)),O=this.eventProcessor.processEvents(d??[]);O.sort((g,v)=>new Date(g.start).getTime()-new Date(v.start).getTime());let p=yield Promise.all(O.map(g=>C(this,null,function*(){let v=yield _(this.visitRecordService.getByEventId(g.id,g.calendarId)),T=null;v?.clientId&&(T=yield _(this.clientService.getById(v.clientId)));let I=[];if(v?.petIds&&v.petIds.length>0){let ut=yield _(this.petService.getAll());I=v.petIds.map(E=>ut.find(ht=>ht.id===E)?.name).filter(E=>!!E)}return{event:g,visitRecord:v,displayStatus:v?.status||"scheduled",clientName:T?.name||this.extractClientName(g.title||"Unknown Client"),serviceType:this.extractServiceType(g.title||""),linkedClient:T,petNames:I}})));this.visits.set(p)}catch(t){console.error("Error loading today's visits:",t)}finally{this.isLoading.set(!1)}})}extractClientName(t){return t.split(" - ")[0].trim()}extractServiceType(t){let i=t.split(" - ");return i.length>1?i[1].trim():"Visit"}createVisit(t){return C(this,null,function*(){try{let i=yield _(this.clientService.getAll()),r=ft(i,t.event);if(r)yield _(this.visitRecordService.linkClient(t.event.id,t.event.calendarId,r)),this.snackBar.open("Visit created and client linked","Close",{duration:2e3});else{let d=V(t.event);yield this.showLinkClientDialog(t.event,i,d||void 0)}yield this.loadTodayVisits()}catch(i){console.error("Error creating visit:",i),this.snackBar.open("Error creating visit","Close",{duration:3e3})}})}linkClient(t){return C(this,null,function*(){try{let i=yield _(this.clientService.getAll()),r=V(t.event),d=t.visitRecord?.clientId;yield this.showLinkClientDialog(t.event,i,r||void 0,d),yield this.loadTodayVisits()}catch(i){console.error("Error linking client:",i),this.snackBar.open("Error linking client","Close",{duration:3e3})}})}showLinkClientDialog(t,i,r,d){return C(this,null,function*(){let O=this.dialog.open(vt,{width:"600px",data:{clients:i,candidateName:r,currentClientId:d}}),p=yield _(O.afterClosed());if(!(!p||p.action==="cancel")){if(p.action==="select"&&p.clientId)yield _(this.visitRecordService.linkClient(t.id,t.calendarId,p.clientId)),this.snackBar.open("Client linked","Close",{duration:2e3});else if(p.action==="create"&&p.newClient){let g=yield _(this.clientService.create(p.newClient));yield _(this.visitRecordService.linkClient(t.id,t.calendarId,g.id)),this.snackBar.open("Client created and linked","Close",{duration:2e3})}}})}checkIn(t){return C(this,null,function*(){if(t.visitRecord)try{yield _(this.visitRecordService.checkIn({id:t.visitRecord.id,checkInAt:new Date})),yield this.loadTodayVisits()}catch(i){console.error("Error checking in:",i)}})}checkOut(t){return C(this,null,function*(){if(t.visitRecord)try{yield _(this.visitRecordService.checkOut({id:t.visitRecord.id,checkOutAt:new Date})),yield this.loadTodayVisits()}catch(i){console.error("Error checking out:",i)}})}getStatusColor(t){switch(t){case"scheduled":return"primary";case"in-progress":return"accent";case"completed":return"warn";default:return""}}formatTime(t){return it(new Date(t),"h:mm a")}connectCalendar(){return C(this,null,function*(){try{yield this.googleCalendarService.signIn(),this.isConnected.set(!0),yield this.loadTodayVisits()}catch(t){console.error("Error connecting to calendar:",t)}})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=R({type:e,selectors:[["app-today"]],standalone:!0,features:[B],decls:13,vars:5,consts:[[1,"today-container"],[1,"today-header"],[1,"header-actions"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"connection-card"],[1,"loading-container"],[1,"empty-card"],[1,"visits-list"],["icon","cloud_off","title","Calendar Not Connected","message","Connect to Google Calendar to see today's visits"],["mat-raised-button","","color","primary",3,"click"],["diameter","40"],["icon","event_available","title","No Visits Today","message","You have no scheduled visits for today. Enjoy your day off!"],[1,"visit-card",3,"completed","in-progress"],[1,"visit-card"],[1,"visit-time"],["highlighted","",3,"color"],[1,"visit-info"],[1,"client-name-row"],["matTooltip","Client linked",1,"linked-icon"],[1,"service-type"],[1,"pet-names"],[1,"location"],[1,"visit-notes"],["mat-raised-button","","color","primary"],["mat-stroked-button","","color","primary"],["mat-raised-button","","color","accent"],["mat-button","",3,"routerLink"],["mat-stroked-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Today's Visits"),n(),o(4,"div",2)(5,"button",3),u("click",function(){return r.loadTodayVisits()}),o(6,"mat-icon"),a(7,"refresh"),n(),a(8," Refresh "),n()()(),x(9,Mt,7,0,"mat-card",4)(10,Pt,4,0,"div",5)(11,Ot,3,0,"mat-card",6)(12,Ft,3,0,"div",7),n()),i&2&&(c(5),S("disabled",r.isLoading()),c(4),m(9,r.isConnected()?-1:9),c(),m(10,r.isLoading()?10:-1),c(),m(11,!r.isLoading()&&r.isConnected()&&r.visits().length===0?11:-1),c(),m(12,!r.isLoading()&&r.isConnected()&&r.visits().length>0?12:-1))},dependencies:[z,N,U,j,G,A,H,q,Y,K,J,_t,mt,W,Q,pt,Z,X,gt,dt],styles:[".today-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:1200px;margin:0 auto}.today-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.today-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2rem;font-weight:500}.today-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem}.connection-card[_ngcontent-%COMP%], .empty-card[_ngcontent-%COMP%]{margin:2rem 0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem;gap:1rem}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--on-surface-variant);margin:0}.visits-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.visit-card[_ngcontent-%COMP%]{transition:all .3s ease}.visit-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #00000026}.visit-card.completed[_ngcontent-%COMP%]{opacity:.8;border-left:4px solid #4caf50}.visit-card.in-progress[_ngcontent-%COMP%]{border-left:4px solid #ff9800}.visit-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background-color:var(--surface-container-high);border-bottom:1px solid var(--outline-variant)}.visit-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .visit-time[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:1.1rem;font-weight:500}.visit-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .visit-time[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--primary)}.visit-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:1.5rem}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .client-name-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .client-name-row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:500}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .client-name-row[_ngcontent-%COMP%]   .linked-icon[_ngcontent-%COMP%]{color:var(--primary);font-size:1.25rem;width:1.25rem;height:1.25rem}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:.5rem 0;color:var(--on-surface-variant)}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .service-type[_ngcontent-%COMP%]{font-size:1rem;font-weight:500}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .pet-names[_ngcontent-%COMP%]{font-size:.9rem;color:var(--primary);font-weight:500}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .pet-names[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--primary)}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{font-size:.9rem}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .visit-notes[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:var(--surface-container-high);border-radius:8px;display:flex;gap:.5rem}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .visit-notes[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{flex-shrink:0;color:var(--primary)}.visit-card[_ngcontent-%COMP%]   .visit-info[_ngcontent-%COMP%]   .visit-notes[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--on-surface)}.visit-card[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]{padding:1rem 1.5rem;display:flex;gap:1rem;border-top:1px solid var(--outline-variant)}@media (max-width: 768px){.today-container[_ngcontent-%COMP%]{padding:1rem}.today-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.today-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.visit-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}"]})}}return e})();export{de as TodayComponent};
